// This file is part of Moodle - http://moodle.org/
// Compiled AMD module for mod_flipbook

define(["jquery"],function(a){return{init:function(b){a(document).ready(function(){function c(b){return l.getPage(b).then(function(b){var c=1.5,d=b.getViewport({scale:c}),e=document.createElement("canvas"),f=e.getContext("2d");return e.height=d.height,e.width=d.width,b.render({canvasContext:f,viewport:d}).promise.then(function(){var b=e.toDataURL("image/png"),c=a('<div class="page"><img src="'+b+'" /></div>');a("#flipbook").append(c)})})}function d(){a("#prev-page").on("click",function(){a("#flipbook").turn("previous")}),a("#next-page").on("click",function(){a("#flipbook").turn("next")}),a("#page-input").on("change",function(){var b=parseInt(a(this).val());b>=1&&b<=m&&a("#flipbook").turn("page",b)}),a("#zoom-in").on("click",function(){g&&j<i&&(j+=k,e())}),a("#zoom-out").on("click",function(){g&&j>h&&(j-=k,e())}),a("#fullscreen").on("click",f),a("#download-pdf").on("click",function(){window.open(n,"_blank")}),a("#flipbook").bind("turning",function(a,b,c){o()}),a(document).on("keydown",function(b){37===b.keyCode?a("#flipbook").turn("previous"):39===b.keyCode&&a("#flipbook").turn("next")})}function e(){var b=n*2*j,c=o*j;a("#flipbook").turn("size",b,c),a("#flipbook-viewer").addClass("zoom-in"),setTimeout(function(){a("#flipbook-viewer").removeClass("zoom-in")},300)}function f(){a("#flipbook-container").toggleClass("flipbook-fullscreen"),a("#flipbook-container").hasClass("flipbook-fullscreen")?a("#fullscreen i").removeClass("fa-expand").addClass("fa-compress"):a("#fullscreen i").removeClass("fa-compress").addClass("fa-expand"),setTimeout(function(){a("#flipbook").turn("resize")},100)}function g(a){p=setInterval(function(){var b=a("#flipbook").turn("page");b<m?a("#flipbook").turn("next"):h()},1e3*a)}function h(){p&&(clearInterval(p),p=null)}function o(){var b=a("#flipbook").turn("page");a("#page-input").val(b),a("#total-pages").text(" / "+m),a("#page-info").text("PÃ¡gina "+b+" de "+m),a("#prev-page").prop("disabled",1===b),a("#next-page").prop("disabled",b===m)}var n=b.pdfUrl,o=b.width,p=b.height,g=b.zoom,q=b.autoflip,h=1,i=.5,j=2,k=.2,p=null,m=0,l=null;pdfjsLib.GlobalWorkerOptions.workerSrc=M.cfg.wwwroot+"/mod/flipbook/js/pdf.worker.min.js";var r=pdfjsLib.getDocument(n);r.promise.then(function(b){l=b,m=b.numPages;for(var d=[],e=1;e<=m;e++)d.push(c(e));return Promise.all(d)}).then(function(){a("#loading-message").hide(),a("#flipbook").turn({width:2*o,height:p,autoCenter:!0,acceleration:!0,elevation:50,gradients:!0,duration:1e3}),o(),d(),q>0&&g(q)})["catch"](function(b){console.error("Error loading PDF:",b),a("#loading-message").html('<i class="fa fa-exclamation-triangle fa-3x" style="color: red;"></i><p>Error al cargar el PDF</p>')}),a("#flipbook-controls button, #flipbook").on("click",function(){q>0&&h()})})}}});